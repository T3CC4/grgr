<%- include('partials/header', { title: 'Dashboard - Discord Bot' }) %>
<%- include('partials/navbar', { user: user, activeTab: 'dashboard' }) %>

<div class="container mt-4">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col">
            <h1 class="display-6">Welcome back, <%= user.username %>!</h1>
            <p class="lead text-muted">Manage your Discord servers with the bot dashboard</p>
        </div>
    </div>

    <%- include('partials/alert', { message: message, messageType: messageType }) %>

    <!-- Statistics Cards -->
    <div class="row mb-5">
        <% const stats = [
            { icon: 'bi-servers', color: 'primary', value: guilds.length, label: 'Manageable Servers' },
            { icon: 'bi-robot', color: 'success', value: guilds.filter(g => g.botInGuild).length, label: 'Bot Active' },
            { icon: 'bi-people', color: 'info', value: totalMembers || '-', label: 'Total Members' },
            { icon: 'bi-activity', color: 'warning', value: 'Online', label: 'Bot Status' }
        ] %>
        <% stats.forEach(stat => { %>
            <div class="col-md-3">
                <div class="card text-center">
                    <div class="card-body">
                        <i class="bi <%= stat.icon %> text-<%= stat.color %> fs-1"></i>
                        <h5 class="card-title mt-2"><%= stat.value %></h5>
                        <p class="card-text text-muted"><%= stat.label %></p>
                    </div>
                </div>
            </div>
        <% }) %>
    </div>

    <!-- Server Selection -->
    <div class="row">
        <div class="col">
            <h3 class="mb-4">Your Servers</h3>
            
            <% if (guilds.length === 0) { %>
                <div class="text-center py-5">
                    <i class="bi bi-inbox text-muted" style="font-size: 4rem;"></i>
                    <h4 class="text-muted mt-3">No manageable servers found</h4>
                    <p class="text-muted">You need "Manage Server" permission to see servers here.</p>
                </div>
            <% } else { %>
                <div class="row g-4">
                    <% guilds.forEach(guild => { %>
                        <div class="col-md-6 col-lg-4">
                            <%- include('partials/guild-card', { guild: guild, botInviteURL: botInviteURL }) %>
                        </div>
                    <% }); %>
                </div>
            <% } %>
        </div>
    </div>
</div>

<%- include('partials/footer', { botInviteURL: botInviteURL }) %>